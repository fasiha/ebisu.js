"use strict";var ebisu=(()=>{var V=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ue=Object.prototype.hasOwnProperty;var H=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),me=(n,e)=>{for(var r in e)V(n,r,{get:e[r],enumerable:!0})},le=(n,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ae(e))!ue.call(n,o)&&o!==r&&V(n,o,{get:()=>e[o],enumerable:!(t=ie(e,o))||t.enumerable});return n};var ce=n=>le(V({},"__esModule",{value:!0}),n);var W=H((Re,Q)=>{"use strict";var T=2/(1+Math.sqrt(5));Q.exports=fe;function fe(n,e,r,t,o,a){for(var u,i,m=0,c=r-T*(r-e),s=e+T*(r-e),f=n(c),l=n(s),h=n(e),g=n(r),I=e,v=r;++m<o&&Math.abs(r-e)>t;)l>f?(r=s,s=c,l=f,c=r-T*(r-e),f=n(c)):(e=c,c=s,f=l,s=e+T*(r-e),l=n(s));return u=.5*(r+e),i=.5*(f+l),a&&(a.iterations=m,a.argmin=u,a.minimum=i,a.converged=!0),isNaN(l)||isNaN(f)||m===o?(a&&(a.converged=!1),NaN):h<i?I:g<i?v:u}});var Y=H((Se,X)=>{"use strict";X.exports=se;function se(n,e,r,t,o,a,u){var i,m,c,s,f,l,h;for(s=1,f=r,l=r,c=m=i=e(r);!h&&isFinite(t)&&!isNaN(t);)if(++s,h=!0,m<=c&&(c=m,f=Math.max(o,f-t),m=e(f),h=!1),i<=c&&(c=i,l=Math.min(a,l+t),i=e(l),h=!1),c=Math.min(c,m,i),(m===c&&f===o||i===c&&l===a)&&(h=!0),t*=s<4?2:Math.exp(s*.5),!isFinite(t))return n[0]=-1/0,n[1]=1/0,n;return n[0]=f,n[1]=l,n}});var _=H((Ae,Z)=>{"use strict";var de=W(),he=Y(),B=[0,0];Z.exports=function(e,r,t){r=r||{};var o,a=r.tolerance===void 0?1e-8:r.tolerance,u=r.initialIncrement===void 0?1:r.initialIncrement,i=r.lowerBound===void 0?-1/0:r.lowerBound,m=r.upperBound===void 0?1/0:r.upperBound,c=r.maxIterations===void 0?100:r.maxIterations;if(t&&(t.iterations=0,t.argmin=NaN,t.minimum=1/0,t.converged=!1),isFinite(m)&&isFinite(i))B[0]=i,B[1]=m;else if(r.guess===void 0?i>-1/0?o=m<1/0?.5*(i+m):i:o=m<1/0?m:0:o=r.guess,he(B,e,o,u,i,m,c),isNaN(B[0])||isNaN(B[1]))return NaN;return de(e,B[0],B[1],a,c,t)}});var L=H((De,J)=>{var $=7,z=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23],be=607/128,q=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function U(n){if(n<0)return Number("0/0");for(var e=q[0],r=q.length-1;r>0;--r)e+=q[r]/(n+r);var t=n+be+.5;return .5*Math.log(2*Math.PI)+(n+.5)*Math.log(t)-t+Math.log(e)-Math.log(n)}J.exports=function n(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*n(1-e));if(e>100)return Math.exp(U(e));e-=1;for(var r=z[0],t=1;t<$+2;t++)r+=z[t]/(e+t);var o=e+$+.5;return Math.sqrt(2*Math.PI)*Math.pow(o,e+.5)*Math.exp(-o)*r};J.exports.log=U});var Ne={};me(Ne,{defaultModel:()=>Ee,modelToPercentileDecay:()=>ye,predictRecall:()=>oe,updateRecall:()=>Be});var P=_();var A=L(),y=A.log;var Me=Math.exp,ge=Math.log,pe=Math.sign,ve=Math.max;function C(n,e){let r=ve(...n),t=0;for(let u=n.length-1;u>=0;u--)t+=e[u]*Me(n[u]-r);let o=pe(t);return t*=o,[ge(t)+r,o]}var k=new Map;function D(n){let e=k.get(n);return e!==void 0||(e=y(n),k.set(n,e)),e}function we(n,e,r){return y(n)-y(n+r)+D(e+r)-D(e)}var ee=(n,e)=>D(n)+D(e)-D(n+e),F=(n,e)=>y(n)+y(e)-y(n+e),O=(n,e)=>A(n)*A(e)/A(n+e);function xe(n,e){return-ee(1+n-e,1+e)-Math.log(n+1)}function ne(n,e){var r=n*(1-n)/e-1,t=n*r,o=(1-n)*r;return[t,o]}function re(n,e,r=!1){let[t,o,a]=n,u=e/a,i=we(t+u,t,o);return r?Math.exp(i):i}function te(n,e,r,t,o,a=!0,u,i){if(0>e||e>r||r<1)throw new Error("0 <= successes and successes <= total and 1 <= total must be true");if(r===1)return K(n,e,t,o,a,u,i);if(!(e===Math.trunc(e)&&r===Math.trunc(r)))throw new Error("expecting integer successes and total");let[m,c,s]=n,f=t/s,l=r-e,h=[];for(let x=0;x<=l;x++)h.push(xe(l,x));function g(x,b){let d=[];for(let M=0;M<=l;M++)d.push(h[M]+ee(m+f*(e+M)+x*f*b,c));let p=[];for(let M=0;M<=l;M++)p.push(Math.pow(-1,M));return C(d,p)[0]}let I=g(0,0),v;if(a){let x=Math.log(.5),b=M=>g(1,M)-I-x,d={},p=P(M=>Math.abs(b(M)),{},d);if(!("converged"in d)||!d.converged)throw new Error("failed to converge");v=p,u=v*t}u||(u=s),v=u/t;let E=g(1,v)-I,N=Math.exp(E),w=Math.exp(g(2,v)-I);if(N<=0)throw new Error("negative mean encountered");if(w<=0)throw new Error("negative 2nd moment encountered");let R=Math.exp(2*E),j=w-R;if(j<=0)throw new Error("negative variance encountered");let[G,S]=ne(N,j);return[G,S,u]}function K(n,e,r,t,o=!0,a,u=!1){if(!(0<=e&&e<=1))throw new Error("expecting result between 0 and 1 inclusive");let[i,m,c]=n,s=e>.5,f=s?e:1-e;t===void 0&&(t=1-f);let l=r/c,[h,g]=s?[f-t,t]:[t-f,1-t],I=h*O(i+l,m)+g*(O(i,m)||0),v=u?C([F(i+l,m),F(i,m)||-1/0],[h,g])[0]:0;function E(b,d){let p=h*O(i+l+b*l*d,m);return g!==0&&(p+=g*O(i+b*l*d,m)),p/I}function N(b,d){return g!==0?C([F(i+l+b*l*d,m),F(i+b*l*d,m)],[h,g])[0]-v:Math.log(h)+F(i+l+b*l*d,m)-v}let w;if(o){let b={},d;if(u){let p=Math.log(.5);d=P(M=>Math.abs(N(1,M)-p),{lowerBound:0},b)}else d=P(p=>Math.abs(E(1,p)-.5),{lowerBound:0},b);if(!("converged"in b)||!b.converged){if(!u)return K(n,e,r,t,o,a,!u);throw console.error(b,{prior:n,result:e,tnow:r,q0:t,rebalance:o,tback:a}),new Error("failed to converge")}w=d,a=w*r}else a||(a=c),w=a/r;let R=u?Math.exp(N(1,w)):E(1,w),G=(u?Math.exp(N(2,w)):E(2,w))-R*R,[S,x]=ne(R,G);if(!(S>0&&x>0&&isFinite(S)&&isFinite(x))){if(!u)return K(n,e,r,t,o,a,!u);throw new Error("newAlpha and newBeta must be finite and greater than zero")}return[S,x,a]}function oe(n,e,r){let t=Math.log2(1+e/n[2]);return re(n,t*n[2],r)}function Be(n,e,r,t,o){let a=Math.log2(1+t/n[2]);return te(n,e,r,a*n[2],o,!1)}function ye(n,e=.5,r){if(!(0<e&&e<1))throw new Error("percentile \u2208 (0, 1)");let t=Math.log(e),o={},a=P(u=>Math.abs(t-oe(n,u)),{lowerBound:1e-14,guess:n[2],tolerance:r},o);if(!o.converged)throw new Error("failed to converge");return a}function Ee(n,e=2,r=e){return[e,r,n]}return ce(Ne);})();
//# sourceMappingURL=ebisu.min.js.map
