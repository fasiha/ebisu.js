var O=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var K=O((de,J)=>{"use strict";var T=2/(1+Math.sqrt(5));J.exports=ne;function ne(n,e,r,t,u,a){for(var m,o,i=0,c=r-T*(r-e),f=e+T*(r-e),s=n(c),l=n(f),d=n(e),M=n(r),B=e,p=r;++i<u&&Math.abs(r-e)>t;)l>s?(r=f,f=c,l=s,c=r-T*(r-e),s=n(c)):(e=c,c=f,s=l,f=e+T*(r-e),l=n(f));return m=.5*(r+e),o=.5*(s+l),a&&(a.iterations=i,a.argmin=m,a.minimum=o,a.converged=!0),isNaN(l)||isNaN(s)||i===u?(a&&(a.converged=!1),NaN):d<o?B:M<o?p:m}});var W=O((be,Q)=>{"use strict";Q.exports=re;function re(n,e,r,t,u,a,m){var o,i,c,f,s,l,d;for(f=1,s=r,l=r,c=i=o=e(r);!d&&isFinite(t)&&!isNaN(t);)if(++f,d=!0,i<=c&&(c=i,s=Math.max(u,s-t),i=e(s),d=!1),o<=c&&(c=o,l=Math.min(a,l+t),o=e(l),d=!1),c=Math.min(c,i,o),(i===c&&s===u||o===c&&l===a)&&(d=!0),t*=f<4?2:Math.exp(f*.5),!isFinite(t))return n[0]=-1/0,n[1]=1/0,n;return n[0]=s,n[1]=l,n}});var Y=O((ge,X)=>{"use strict";var te=K(),oe=W(),N=[0,0];X.exports=function(e,r,t){r=r||{};var u,a=r.tolerance===void 0?1e-8:r.tolerance,m=r.initialIncrement===void 0?1:r.initialIncrement,o=r.lowerBound===void 0?-1/0:r.lowerBound,i=r.upperBound===void 0?1/0:r.upperBound,c=r.maxIterations===void 0?100:r.maxIterations;if(t&&(t.iterations=0,t.argmin=NaN,t.minimum=1/0,t.converged=!1),isFinite(i)&&isFinite(o))N[0]=o,N[1]=i;else if(r.guess===void 0?o>-1/0?u=i<1/0?.5*(o+i):o:u=i<1/0?i:0:u=r.guess,oe(N,e,u,m,o,i,c),isNaN(N[0])||isNaN(N[1]))return NaN;return te(e,N[0],N[1],a,c,t)}});var U=O((ve,V)=>{var Z=7,$=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23],ie=607/128,G=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function z(n){if(n<0)return Number("0/0");for(var e=G[0],r=G.length-1;r>0;--r)e+=G[r]/(n+r);var t=n+ie+.5;return .5*Math.log(2*Math.PI)+(n+.5)*Math.log(t)-t+Math.log(e)-Math.log(n)}V.exports=function n(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*n(1-e));if(e>100)return Math.exp(z(e));e-=1;for(var r=$[0],t=1;t<Z+2;t++)r+=$[t]/(e+t);var u=e+Z+.5;return Math.sqrt(2*Math.PI)*Math.pow(u,e+.5)*Math.exp(-u)*r};V.exports.log=z});var R=Y();var S=U(),E=S.log;var ae=Math.exp,ue=Math.log,me=Math.sign,le=Math.max;function _(n,e){let r=le(...n),t=0;for(let m=n.length-1;m>=0;m--)t+=e[m]*ae(n[m]-r);let u=me(t);return t*=u,[ue(t)+r,u]}var L=new Map;function C(n){let e=L.get(n);return e!==void 0||(e=E(n),L.set(n,e)),e}function ce(n,e,r){return E(n)-E(n+r)+C(e+r)-C(e)}var I=(n,e)=>C(n)+C(e)-C(n+e),H=(n,e)=>E(n)+E(e)-E(n+e),A=(n,e)=>S(n)*S(e)/S(n+e);function fe(n,e){return-I(1+n-e,1+e)-Math.log(n+1)}function Ne(n){let e={betaln:I,betafn:A};return n.betaln&&(I=n.betaln),n.betafn&&(A=n.betafn),e}function k(n,e){var r=n*(1-n)/e-1,t=n*r,u=(1-n)*r;return[t,u]}function Ee(n,e,r=!1){let[t,u,a]=n,m=e/a,o=ce(t+m,t,u);return r?Math.exp(o):o}function ye(n,e,r,t,u,a=!0,m,o){if(0>e||e>r||r<1)throw new Error("0 <= successes and successes <= total and 1 <= total must be true");if(r===1)return ee(n,e,t,u,a,m,o);if(!(e===Math.trunc(e)&&r===Math.trunc(r)))throw new Error("expecting integer successes and total");let[i,c,f]=n,s=t/f,l=r-e,d=[];for(let x=0;x<=l;x++)d.push(fe(l,x));function M(x,b){let h=[];for(let g=0;g<=l;g++)h.push(d[g]+I(i+s*(e+g)+x*s*b,c));let v=[];for(let g=0;g<=l;g++)v.push(Math.pow(-1,g));return _(h,v)[0]}let B=M(0,0),p;if(a){let x=Math.log(.5),b=g=>M(1,g)-B-x,h={},v=R(g=>Math.abs(b(g)),{},h);if(!("converged"in h)||!h.converged)throw new Error("failed to converge");p=v,m=p*t}m||(m=f),p=m/t;let y=M(1,p)-B,P=Math.exp(y),w=Math.exp(M(2,p)-B);if(P<=0)throw new Error("negative mean encountered");if(w<=0)throw new Error("negative 2nd moment encountered");let F=Math.exp(2*y),j=w-F;if(j<=0)throw new Error("negative variance encountered");let[q,D]=k(P,j);return[q,D,m]}function ee(n,e,r,t,u=!0,a,m=!1){if(!(0<=e&&e<=1))throw new Error("expecting result between 0 and 1 inclusive");let[o,i,c]=n,f=e>.5,s=f?e:1-e;t===void 0&&(t=1-s);let l=r/c,[d,M]=f?[s-t,t]:[t-s,1-t],B=d*A(o+l,i)+M*(A(o,i)||0),p=m?_([H(o+l,i),H(o,i)||-1/0],[d,M])[0]:0;function y(b,h){let v=d*A(o+l+b*l*h,i);return M!==0&&(v+=M*A(o+b*l*h,i)),v/B}function P(b,h){return M!==0?_([H(o+l+b*l*h,i),H(o+b*l*h,i)],[d,M])[0]-p:Math.log(d)+H(o+l+b*l*h,i)-p}let w;if(u){let b={},h;if(m){let v=Math.log(.5);h=R(g=>Math.abs(P(1,g)-v),{lowerBound:0},b)}else h=R(v=>Math.abs(y(1,v)-.5),{lowerBound:0},b);if(!("converged"in b)||!b.converged){if(!m)return ee(n,e,r,t,u,a,!0);throw console.error(b,{prior:n,result:e,tnow:r,q0:t,rebalance:u,tback:a}),new Error("failed to converge")}w=h,a=w*r}else a||(a=c),w=a/r;let F=m?Math.exp(P(1,w)):y(1,w),q=(m?Math.exp(P(2,w)):y(2,w))-F*F,[D,x]=k(F,q);if(D<=0||x<=0)throw new Error("newAlpha and newBeta must be greater than zero");return[D,x,a]}function Pe(n,e=4,r=e){return[e,r,n]}function se(n,e=.5,r=1e-4){if(e<0||e>1)throw new Error("percentiles must be between (0, 1) exclusive");let[t,u,a]=n,m=I(t,u),o=Math.log(e);function i(s){let l=I(t+s,u)-m;return Math.abs(l-o)}let c={},f=R(i,{lowerBound:0,tolerance:r},c);if(!("converged"in c)||!c.converged)throw new Error("failed to converge");return f*a}function Ae(n,e=1){let[r,t,u]=n,a=se(n),m=a/u,o=I(r,t),i=I(r+2*m,t)-o,f=1/(8*Math.exp(i)-2)-.5;if(f<=0)throw new Error("non-positive alpha, beta encountered");return[f,f,a*e]}export{Ne as customizeMath,Pe as defaultModel,se as modelToPercentileDecay,Ee as predictRecall,Ae as rescaleHalflife,ye as updateRecall};
//# sourceMappingURL=ebisu.min.mjs.map
